# Задача бассейны  

---

## Задача

Есть набор бассейнов. Бассейны могут соединяться друг с другом с помощью каналов. В этом случае они сообщаются друг с другом, и с этого момента
содержащаяся в них вода распределяется в равных пропорциях.

Необходимо реализовать функциональность для моделирования этих бассейнов.
Требуемые операции:
1. Добавить воду в бассейн.
2. Соединить 2 бассейна с помощью канала.
3. Показать объём воды в бассейне.

---

## Решение

_Ключева идея_: пусть каждый бассейн принадлежит какому-то семейству. Изначально у каждого бассейна есть своё отдельное 
семейство, а при соединении двух бассейнов нам просто нужно соединить два семейства если они разные.  
Для того что-бы было удобнее объединять пусть каждое семейство будет иметь представителя(кто-то из членов) тогда для 
соединения семейств нужно просто одного из представителей сделать представителем обоих семейств.  
Для того что бы узнать количество воды в отдельном будем хранить количество воды всего, в семействе. Тогда для того что 
бы узнать количество воды в отдельном бассейне нужно количеств воды в семействе разделить количество членов.  
Если присмотреться то, становиться понятно что это по сути _Система Непересекающихся Множеств_.  
Значит можем сразу получить все асимптотики:  
```c++
double measure() <=> DSU->GET() ~ O(log(n))

void add() <=> DSU->GET() ~ O(log(n))

void connect() <=> DSU->UNION() ~ O(log(n))
```  
В данном случае я использовал _эвристику сжатия путей_ и _ранговую эвристику_, так что на самом дела операции
выполняются за амортизированную константу, а именно _O(\alpha(n, m))_, где n - общее число операций, m - число
элементов а \alpha(n, m) - обратная к функции Аккермана.

---

## Детали реализации

Т.к. я использую СНМ, то должен хранить указатель на представителя моего семейства, поэтому с бассейнами нельзя 
проводить операции инвалидирующие указатели. Например нельзя:
```c++
std::vectir<pool::Pool> pools;

pools.emplace_back(100);
pools.emplace_back(120); // может произойти реалокация и попортить указатели
```

Сам проект представляет собой CLion project, так что можно его открыть в CLion.
Есть три профиля сборки:  
1. TEST1 - проверка корректности работы.
2. TEST2 - тест на время работы при 16e6 бассейнах и 6e6 соединениях(соединения случайны).
3. TEST3 - тест на время работы. Ввод количества бассейнов и соединений(соединения случайны).